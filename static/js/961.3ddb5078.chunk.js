"use strict";(self.webpackChunkproject_mania=self.webpackChunkproject_mania||[]).push([[961],{4961:function(n,e,t){t.r(e),t.d(e,{default:function(){return J}});var s=t(3433),i=t(4165),a=t(5861),r=t(9439),c=t(2791),o=t(4373),l=t(2741),u=t(9434),d=t(5224),f=t(6974),v=t(7145),m=t(184),h=function(){var n=(0,c.useState)(""),e=(0,r.Z)(n,2),t=e[0],s=e[1],i=(0,l.Z)().user,a=(0,c.useRef)(),h=(0,u.v9)(d.HL),x=(0,f.Z)(),Z=x.currentChat,j=x.handleSendMessage,p=(0,c.useState)(!1),g=(0,r.Z)(p,2),_=g[0],N=g[1],w=function(n){if(n.preventDefault(),t&&Z&&h){var e=new Date,a={text:t,from:i._id,sent_at:e.toISOString(),to:h._id};j(Z._id,a),s("")}};return(0,c.useEffect)((function(){if(!t)return N(!1),void(0,v.OA)(null===Z||void 0===Z?void 0:Z._id,null===h||void 0===h?void 0:h.socket_id,i._id);_||N(!0)}),[t]),(0,c.useEffect)((function(){_&&(0,v.FN)(null===Z||void 0===Z?void 0:Z._id,null===h||void 0===h?void 0:h.socket_id,i._id)}),[_]),(0,m.jsxs)("form",{id:"chat-input-container",onSubmit:w,children:[(0,m.jsx)("input",{type:"text",name:"chat_input",id:"chat_input",onChange:function(n){return s(n.target.value)},value:t,placeholder:"Type a message...",ref:a}),(0,m.jsx)("button",{type:"submit",className:"icon-span",onClick:w,children:(0,m.jsx)(o.ghy,{className:"icon large"})})]})},x=t(995),Z=t(1413),j=t(7470),p=t(2126),g=function(n){var e=n.msg,t=n.currentContact,s=e.sent_at,i=e.text,a=e.from;return(0,m.jsx)(m.Fragment,{children:(0,m.jsxs)("div",{className:a!==(null===t||void 0===t?void 0:t._id)?"message-container right-side":"message-container",children:[(0,m.jsx)("p",{className:"message",children:i}),(0,m.jsx)("span",{children:(0,p.I7)(s)})]})})},_=t(6747),N=t(2048),w=t(9143),C=t(5680),b=t(6594),E=t(3884),k=t(8820),y=t(9126),I=t(4522),S=t(7480),L=function(){var n=(0,f.Z)(),e=n.currentContact,t=n.messages,o=n.currentChat,v=n.setMessages,h=(0,c.useState)(""),L=(0,r.Z)(h,2),T=L[0],F=L[1],R=(0,u.I0)(),O=(0,c.useRef)(null),V=(0,c.useState)(!1),K=(0,r.Z)(V,2),M=K[0],z=K[1],A=(0,l.Z)().userInfo,D=(0,u.v9)(d.Tc);(0,b.Z)({events:{typing:function(n){n.userId===e._id&&z(!0)},notTyping:function(n){n.userId===e._id&&z(!1)}}});var q=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e){return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!D.some((function(n){return n===e}))){n.next=6;break}return n.next=3,(0,I.Nq)((0,Z.Z)((0,Z.Z)({},A),{},{favorites:(0,s.Z)(A.favorites.filter((function(n){return n!==e})))}));case 3:R((0,C.Lo)((0,s.Z)(D.filter((function(n){return n!==e}))))),n.next=9;break;case 6:return n.next=8,(0,I.Nq)((0,Z.Z)((0,Z.Z)({},A),{},{favorites:[].concat((0,s.Z)(A.favorites),[e])}));case 8:R((0,C.Lo)([].concat((0,s.Z)(D),[e])));case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,c.useEffect)((function(){if(!e)return F("");F("".concat(e.first_name," ").concat(e.last_name))}),[e]),(0,c.useEffect)((function(){o&&(R(v((0,s.Z)(null===o||void 0===o?void 0:o.messages))),o&&M&&z(!1))}),[o]),(0,c.useEffect)((function(){O.current.scrollIntoView({behavior:"smooth"})}),[t]),(0,c.useEffect)((function(){var n,e;null!==o&&void 0!==o&&null!==(n=o.messages)&&void 0!==n&&n.some((function(n){return!1===n.seen}))&&R((0,C.OK)((0,Z.Z)((0,Z.Z)({},o),{},{messages:(0,s.Z)(null===o||void 0===o||null===(e=o.messages)||void 0===e?void 0:e.map((function(n){return!1===n.seen?(0,Z.Z)((0,Z.Z)({},n),{},{seen:!0}):n})))})))}),[]),(0,m.jsxs)("div",{className:"conversation-container",children:[T&&(0,m.jsxs)("div",{className:"profile",children:[null!==e&&void 0!==e&&e.base64_img_data||null!==e&&void 0!==e&&e.img_url?(0,m.jsx)(N.Z,{src:(null===e||void 0===e?void 0:e.base64_img_data)||(null===e||void 0===e?void 0:e.img_url)}):(0,m.jsx)(w.Z,{}),(0,m.jsxs)("div",{className:"contact-name",children:[(0,m.jsx)("h3",{children:T}),!0===(null===e||void 0===e?void 0:e.online)?(0,m.jsx)("p",{className:"green",children:"online"}):(0,m.jsxs)("p",{children:["last seen ",(0,p.O7)(null===e||void 0===e?void 0:e.last_seen)]})]}),(0,m.jsx)(E.Z,{}),(0,m.jsx)("button",{className:"btn",title:"Add to favorites",onClick:function(){return q(null===e||void 0===e?void 0:e._id)},children:(0,m.jsx)(x.Z,{icon:(0,m.jsx)(y.kRm,{className:D.includes(null===e||void 0===e?void 0:e._id)?"icon star":"icon"})})}),(0,m.jsxs)("button",{className:"btn white",title:"View profile",onClick:function(){return n=e,R((0,S.zJ)(n)),void R((0,S.rC)(!0));var n},children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(k.nf1,{className:"icon xl"})}),(0,m.jsx)("span",{className:"text",children:"View profile"})]})]}),(0,m.jsx)(j.Z,{}),(0,m.jsxs)("div",{className:"conversation",children:[null!==t&&void 0!==t&&t.length?null===t||void 0===t?void 0:t.map((function(n){return(0,m.jsx)(g,{msg:n,currentContact:e},(0,_.H)())})):null,(0,m.jsx)("div",{children:M?(0,m.jsxs)("p",{className:"typing",children:[null===e||void 0===e?void 0:e.first_name," is typing..."]}):null}),(0,m.jsx)("div",{className:"messages-bottom",ref:O})]})]})},T=t(934),F=t(2696),R=t(4942),O=t(6856),V=function(n){var e=n.contactId,t=n.messages,s=n.isTyping,o=(0,f.Z)().getContactInfo,d=(0,l.Z)().userInfo,v=(0,u.I0)(),h=(0,c.useState)(null),Z=(0,r.Z)(h,2),j=Z[0],g=Z[1],_=(0,c.useState)(0),b=(0,r.Z)(_,2),k=(b[0],b[1]),y=(0,c.useState)(null),I=(0,r.Z)(y,2),S=I[0],L=I[1],T=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e,t){var s;return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o(t);case 2:s=n.sent,v((0,C.Ku)(s)),v((0,C.OB)(e,t));case 5:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),F=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e){return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:T(null===d||void 0===d?void 0:d._id,e),v((0,C.EL)(!1));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();(0,c.useEffect)((function(){null!==t&&void 0!==t&&t.length&&(g(t[t.length-1]),k(t.filter((function(n){return!1===n.seen&&n.from!==(null===d||void 0===d?void 0:d._id)})).length))}),[t]);var R=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e){var t;return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o(e);case 2:t=n.sent,L(t);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,c.useEffect)((function(){R(e)}),[]),(0,m.jsxs)("div",{className:"contact",onClick:function(){return F(e)},children:[(0,m.jsx)("div",{className:"contact-image",children:null!==S&&void 0!==S&&S.base64_img_data||null!==S&&void 0!==S&&S.img_url?(0,m.jsx)(N.Z,{src:(null===S||void 0===S?void 0:S.base64_img_data)||(null===S||void 0===S?void 0:S.img_url)}):(0,m.jsx)(w.Z,{})}),(0,m.jsxs)("div",{className:"contact-content",children:[(0,m.jsxs)("h3",{className:"contact-name",children:[null===S||void 0===S?void 0:S.first_name," ",null===S||void 0===S?void 0:S.last_name]}),(0,m.jsx)("span",{className:"last-time-message-sent",children:null!==j&&void 0!==j&&j.sent_at?(0,p.I7)(null===j||void 0===j?void 0:j.sent_at):null}),(0,m.jsx)("p",{className:"last-message",children:s?(0,m.jsx)("span",{className:"typing green",children:"typing..."}):(0,m.jsx)(m.Fragment,{children:(null===j||void 0===j?void 0:j.from)===(null===d||void 0===d?void 0:d._id)?(0,m.jsx)(m.Fragment,{children:!0===(null===j||void 0===j?void 0:j.seen)?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(O.smy,{className:"icon green"})}),null===j||void 0===j?void 0:j.text]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(O.smy,{className:"icon"})}),null===j||void 0===j?void 0:j.text]})}):null===j||void 0===j?void 0:j.text})}),(0,m.jsx)(E.Z,{})]})]})},K=t(1823),M=function(){var n=(0,u.v9)(d.Tc),e=(0,l.Z)().userInfo,t=(0,u.I0)(),i=(0,c.useState)({}),a=(0,r.Z)(i,2),o=a[0],v=a[1],h=(0,u.v9)(d.lp),j=(0,f.Z)().sortChats;return(0,b.Z)({events:{typing:function(n){var e=n.chatId;v((0,Z.Z)((0,Z.Z)({},o),{},(0,R.Z)({},e,!0)))},notTyping:function(n){var e=n.chatId;v((0,Z.Z)((0,Z.Z)({},o),{},(0,R.Z)({},e,!1)))}}}),(0,c.useEffect)((function(){e&&t((0,C.Lo)((0,s.Z)(null===e||void 0===e?void 0:e.favorites)))}),[e]),(0,c.useEffect)((function(){n.length||!h.length||t((0,C.bu)([]))}),[n]),(0,m.jsxs)("div",{className:"favorites-container",children:[(0,m.jsxs)("div",{className:"chat-title",children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(y.kRm,{className:"icon star"})}),(0,m.jsx)("h3",{children:"Favorites"})]}),(0,m.jsx)(c.Suspense,{fallback:(0,m.jsx)(K.Z,{}),children:(0,m.jsx)("div",{className:"favorites",children:null!==h&&void 0!==h&&h.length?(0,m.jsx)(m.Fragment,{children:j(h).map((function(n){return(0,m.jsx)(V,{contactId:null===n||void 0===n?void 0:n.users.find((function(n){return n!==(null===e||void 0===e?void 0:e._id)})),messages:null===n||void 0===n?void 0:n.messages,isTyping:o[null===n||void 0===n?void 0:n._id]},null===n||void 0===n?void 0:n._id)}))}):null})})]})},z=t(34),A=t(6419),D=t(7689),q=t(4083),B=function(){var n=(0,u.v9)(q.eD),e=(0,u.I0)(),t=function(){window.innerWidth<=1280?e((0,S.Ep)(!0)):e((0,S.Ep)(!1))};return(0,c.useEffect)((function(){return window.addEventListener("load",t),window.addEventListener("resize",t),function(){window.removeEventListener("load",t),window.removeEventListener("resize",t)}}),[]),{isMobile:n}},H=t(3479),W=function(){var n=(0,l.Z)().userInfo,e=(0,u.v9)(d.Rt),t=(0,u.v9)(d.Af),s=(0,c.useState)({}),i=(0,r.Z)(s,2),a=i[0],o=i[1],v=(0,f.Z)(),h=v.fetchUserChats,j=v.sortChats,p=(0,u.v9)(d.Tc);return(0,b.Z)({events:{typing:function(n){var e=n.chatId;o((0,Z.Z)((0,Z.Z)({},a),{},(0,R.Z)({},e,!0)))},notTyping:function(n){var e=n.chatId;o((0,Z.Z)((0,Z.Z)({},a),{},(0,R.Z)({},e,!1)))}}}),(0,c.useEffect)((function(){t.length&&n&&h()}),[t,p]),(0,m.jsxs)("div",{className:"chat-contacts",children:[(0,m.jsxs)("div",{className:"chat-title",children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(y.RN2,{className:"icon small blue"})}),(0,m.jsx)("h3",{children:"Chats"})]}),(0,m.jsx)(c.Suspense,{fallback:(0,m.jsx)(K.Z,{}),children:null!==e&&void 0!==e&&e.length?j(e).map((function(e){var t;return(0,m.jsx)(V,{contactId:null===(t=e.users)||void 0===t?void 0:t.find((function(e){return e!==(null===n||void 0===n?void 0:n._id)})),messages:e.messages,isTyping:a[e._id]},e._id)})):null})]})},J=function(){var n=(0,f.Z)(),e=n.loadContacts,t=n.contacts,o=n.createNewChat,v=n.currentChat,Z=(0,l.Z)().userInfo,j=(0,c.useState)(""),p=(0,r.Z)(j,2),g=p[0],_=p[1],b=(0,c.useState)(!1),E=(0,r.Z)(b,2),k=E[0],I=E[1],S=(0,c.useRef)(null),R=(0,c.useState)([]),O=(0,r.Z)(R,2),V=O[0],K=O[1],q=(0,u.I0)(),J=(0,A.Z)().currentProject,P=(0,D.s0)(),U=B().isMobile,G=(0,u.v9)(d.Ss),Q=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e){return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,T.mb)(null===Z||void 0===Z?void 0:Z._id,e._id);case 2:if(!n.sent){n.next=9;break}q((0,C.Ku)(e)),I(!1),_(""),n.next=14;break;case 9:return n.next=11,o(null===Z||void 0===Z?void 0:Z._id,e);case 11:q((0,C.Ku)(e)),I(!1),_("");case 14:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,c.useEffect)((function(){S.current&&g.length?I(!0):I(!1)}),[g]),(0,c.useEffect)((function(){g.length&&function(n){var e=n.toLowerCase(),s=t.filter((function(n){return n.first_name.toLowerCase().includes(e)||n.last_name.toLowerCase().includes(e)||(n.first_name.toLowerCase()||n.last_name.toLowerCase())===e||n.first_name.toLowerCase()+" "+n.last_name.toLowerCase()===e}));K(s)}(g)}),[g]),(0,c.useEffect)((function(){J&&q((0,F.Ce)(null))}),[]),(0,c.useEffect)((function(){t.length&&(t.some((function(n){return n._id===(null===Z||void 0===Z?void 0:Z._id)}))&&q((0,C.WT)((0,s.Z)(t.filter((function(n){return n._id!==(null===Z||void 0===Z?void 0:Z._id)}))))))}),[t]),(0,c.useEffect)((function(){Z&&(e(),q(v?(0,C.OB)(v.users[0],v.users[1]):(0,C.EL)(!0)))}),[]),(0,c.useEffect)((function(){Z||P("/")}),[]),(0,m.jsxs)("div",{className:"main-chat-container",children:[(0,m.jsxs)("div",{className:G?"left open":"left",children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(y.fmn,{className:"icon"}),additionalClass:U?"mobile":"not-mobile",onClick:function(){q((0,C.EL)(!G))}}),(0,m.jsxs)("div",{className:"main-chat-title",children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(H.tNe,{className:"icon"})}),(0,m.jsx)("h1",{children:"Chat"})]}),(0,m.jsx)(z.Z,{type:"text",refValue:S,placeholderText:"Search",fn:function(n){_(n.target.value)},value:g,icon:(0,m.jsx)(x.Z,{icon:(0,m.jsx)(y.dVI,{className:"icon"})})}),k?(0,m.jsx)("div",{className:"chat-search-results",children:V.length?V.map((function(n){return(0,m.jsxs)("div",{className:"profile",onClick:function(){return Q(n)},children:[n.base64_img_data||n.img_url?(0,m.jsx)(N.Z,{src:n.base64_img_data||n.img_url}):(0,m.jsx)(w.Z,{}),(0,m.jsxs)("span",{children:[n.first_name," ",n.last_name]})]},n._id)})):null}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(M,{}),(0,m.jsx)(W,{})]})]}),(0,m.jsxs)("div",{className:"right",children:[(0,m.jsx)(L,{}),(0,m.jsx)(h,{})]})]})}}}]);
//# sourceMappingURL=961.3ddb5078.chunk.js.map