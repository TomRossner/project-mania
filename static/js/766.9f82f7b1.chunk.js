"use strict";(self.webpackChunkproject_mania=self.webpackChunkproject_mania||[]).push([[766],{5777:function(n,e,t){t.r(e),t.d(e,{default:function(){return H}});var i=t(3433),s=t(4165),a=t(5861),r=t(9439),o=t(2791),c=t(4373),l=t(7800),u=t(9434),d=t(5224),f=t(6974),v=t(7145),m=t(184),h=function(){var n=(0,o.useState)(""),e=(0,r.Z)(n,2),t=e[0],i=e[1],s=(0,l.Z)().user,a=(0,o.useRef)(),h=(0,u.v9)(d.HL),x=(0,f.Z)(),j=x.currentChat,Z=x.handleSendMessage,g=(0,o.useState)(!1),p=(0,r.Z)(g,2),_=p[0],N=p[1],b=function(n){if(n.preventDefault(),t&&j&&h){var e=new Date,a={text:t,from:s._id,sent_at:e.toISOString(),to:h._id};Z(j._id,a),i("")}};return(0,o.useEffect)((function(){if(!t.length)return N(!1),void(0,v.OA)(null===j||void 0===j?void 0:j._id,null===h||void 0===h?void 0:h.socket_id);_||N(!0)}),[t]),(0,o.useEffect)((function(){_&&(0,v.FN)(null===j||void 0===j?void 0:j._id,null===h||void 0===h?void 0:h.socket_id)}),[_]),(0,m.jsxs)("form",{id:"chat-input-container",onSubmit:b,children:[(0,m.jsx)("input",{type:"text",name:"chat_input",id:"chat_input",onChange:function(n){return i(n.target.value)},value:t,placeholder:"Type a message...",ref:a}),(0,m.jsx)("button",{type:"submit",className:"icon-span",onClick:b,children:(0,m.jsx)(c.ghy,{className:"icon large"})})]})},x=t(995),j=t(1413),Z=t(7470),g=t(2126),p=function(n){var e=n.msg,t=n.currentContact,i=e.sent_at,s=e.text,a=e.from;return(0,m.jsx)(m.Fragment,{children:(0,m.jsxs)("div",{className:a!==(null===t||void 0===t?void 0:t._id)?"message-container right-side":"message-container",children:[(0,m.jsx)("p",{className:"message",children:s}),(0,m.jsx)("span",{children:(0,g.I7)(i)})]})})},_=t(6747),N=t(2048),b=t(9143),w=t(5680),C=t(6594),k=t(3884),E=t(8820),y=t(9126),I=t(7640),S=t(4888),L=function(){var n=(0,f.Z)(),e=n.currentContact,t=n.messages,c=n.currentChat,v=n.setMessages,h=(0,o.useState)(""),L=(0,r.Z)(h,2),T=L[0],F=L[1],R=(0,u.I0)(),O=(0,o.useRef)(null),M=(0,o.useState)(!1),V=(0,r.Z)(M,2),z=V[0],K=V[1],A=(0,l.Z)().userInfo,D=(0,u.v9)(d.Tc),q=(0,S.Z)().isMobile;(0,C.Z)({events:{typing:function(){return K(!0)},notTyping:function(){return K(!1)}}}),(0,o.useEffect)((function(){if(!e)return F("");F("".concat(e.first_name," ").concat(e.last_name))}),[e]),(0,o.useEffect)((function(){c&&R(v((0,i.Z)(null===c||void 0===c?void 0:c.messages)))}),[c]);(0,o.useEffect)((function(){O.current.scrollIntoView({behavior:"smooth"})}),[t]);var B=function(){var n=(0,a.Z)((0,s.Z)().mark((function n(e){return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!D.some((function(n){return n===e}))){n.next=6;break}return n.next=3,(0,I.Nq)((0,j.Z)((0,j.Z)({},A),{},{favorites:(0,i.Z)(A.favorites.filter((function(n){return n!==e})))}));case 3:R((0,w.Lo)((0,i.Z)(D.filter((function(n){return n!==e}))))),n.next=9;break;case 6:return n.next=8,(0,I.Nq)((0,j.Z)((0,j.Z)({},A),{},{favorites:[].concat((0,i.Z)(A.favorites),[e])}));case 8:R((0,w.Lo)([].concat((0,i.Z)(D),[e])));case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,o.useEffect)((function(){var n,e;null!==c&&void 0!==c&&null!==(n=c.messages)&&void 0!==n&&n.some((function(n){return!1===n.seen}))&&R((0,w.OK)((0,j.Z)((0,j.Z)({},c),{},{messages:(0,i.Z)(null===c||void 0===c||null===(e=c.messages)||void 0===e?void 0:e.map((function(n){return!1===n.seen?(0,j.Z)((0,j.Z)({},n),{},{seen:!0}):n})))})))}),[]),(0,m.jsxs)("div",{className:"conversation-container",children:[T&&(0,m.jsxs)("div",{className:"profile",children:[null!==e&&void 0!==e&&e.base64_img_data||null!==e&&void 0!==e&&e.img_url?(0,m.jsx)(N.Z,{src:(null===e||void 0===e?void 0:e.base64_img_data)||(null===e||void 0===e?void 0:e.img_url)}):(0,m.jsx)(b.Z,{}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h3",{children:T}),!0===(null===e||void 0===e?void 0:e.online)?(0,m.jsx)("p",{className:"green",children:"online"}):(0,m.jsxs)("p",{children:["last seen ",(0,g.O7)(null===e||void 0===e?void 0:e.last_seen)]})]}),(0,m.jsx)(k.Z,{}),(0,m.jsx)("button",{className:"btn",title:"Add to favorites",onClick:function(){return B(null===e||void 0===e?void 0:e._id)},children:(0,m.jsx)(x.Z,{icon:(0,m.jsx)(y.kRm,{className:D.includes(null===e||void 0===e?void 0:e._id)?"icon star":"icon"})})}),(0,m.jsxs)("button",{className:"btn white",title:"View profile",children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(E.nf1,{className:"icon xl"})}),q?"":"View profile"]})]}),(0,m.jsx)(Z.Z,{}),(0,m.jsxs)("div",{className:"conversation",children:[null!==t&&void 0!==t&&t.length?null===t||void 0===t?void 0:t.map((function(n){return(0,m.jsx)(p,{msg:n,currentContact:e},(0,_.H)())})):null,(0,m.jsx)("div",{children:z?(0,m.jsxs)("p",{className:"typing",children:[null===e||void 0===e?void 0:e.first_name," is typing..."]}):null}),(0,m.jsx)("div",{className:"messages-bottom",ref:O})]})]})},T=t(6871),F=t(2696),R=t(4942),O=t(6856),M=function(n){var e=n.contactId,t=n.messages,i=n.isTyping,c=(0,f.Z)(),d=c.getContactInfo,v=(c.currentChat,(0,l.Z)().userInfo),h=(0,u.I0)(),j=(0,o.useState)(null),Z=(0,r.Z)(j,2),p=Z[0],_=Z[1],C=(0,o.useState)(0),E=(0,r.Z)(C,2),y=(E[0],E[1]),I=(0,o.useState)(null),S=(0,r.Z)(I,2),L=S[0],T=S[1],F=function(n,e){h((0,w.OB)(n,e))},R=function(){var n=(0,a.Z)((0,s.Z)().mark((function n(e){return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:F(null===v||void 0===v?void 0:v._id,e),h((0,w.Ku)(L)),h((0,w.EL)(!1));case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();(0,o.useEffect)((function(){null!==t&&void 0!==t&&t.length&&(_(t[t.length-1]),y(t.filter((function(n){return!1===n.seen&&n.from!==(null===v||void 0===v?void 0:v._id)})).length))}),[t]);var M=function(){var n=(0,a.Z)((0,s.Z)().mark((function n(e){var t;return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,d(e);case 2:t=n.sent,T(t);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,o.useEffect)((function(){M(e)}),[]),(0,m.jsxs)("div",{className:"contact",onClick:function(){return R(e)},children:[(0,m.jsx)("div",{className:"contact-image",children:null!==L&&void 0!==L&&L.base64_img_data||null!==L&&void 0!==L&&L.img_url?(0,m.jsx)(N.Z,{src:(null===L||void 0===L?void 0:L.base64_img_data)||(null===L||void 0===L?void 0:L.img_url)}):(0,m.jsx)(b.Z,{})}),(0,m.jsxs)("div",{className:"contact-content",children:[(0,m.jsxs)("h3",{className:"contact-name",children:[null===L||void 0===L?void 0:L.first_name," ",null===L||void 0===L?void 0:L.last_name]}),(0,m.jsx)("span",{className:"last-time-message-sent",children:null!==p&&void 0!==p&&p.sent_at?(0,g.I7)(null===p||void 0===p?void 0:p.sent_at):null}),(0,m.jsx)("p",{className:"last-message",children:i?(0,m.jsx)("span",{className:"typing green",children:"typing..."}):(0,m.jsx)(m.Fragment,{children:(null===p||void 0===p?void 0:p.from)===(null===v||void 0===v?void 0:v._id)?(0,m.jsx)(m.Fragment,{children:!0===(null===p||void 0===p?void 0:p.seen)?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(O.smy,{className:"icon green"})}),null===p||void 0===p?void 0:p.text]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(O.smy,{className:"icon"})}),null===p||void 0===p?void 0:p.text]})}):null===p||void 0===p?void 0:p.text})}),(0,m.jsx)(k.Z,{})]})]})},V=t(1823),z=function(){var n=(0,u.v9)(d.Tc),e=(0,l.Z)().userInfo,t=(0,u.I0)(),s=(0,o.useState)({}),a=(0,r.Z)(s,2),c=a[0],v=a[1],h=(0,u.v9)(d.lp),Z=(0,f.Z)().sortChats;return(0,C.Z)({events:{typing:function(n){var e=n.chatId;v((0,j.Z)((0,j.Z)({},c),{},(0,R.Z)({},e,!0)))},notTyping:function(n){var e=n.chatId;v((0,j.Z)((0,j.Z)({},c),{},(0,R.Z)({},e,!1)))}}}),(0,o.useEffect)((function(){e&&t((0,w.Lo)((0,i.Z)(null===e||void 0===e?void 0:e.favorites)))}),[e]),(0,o.useEffect)((function(){n.length||!h.length||t((0,w.bu)([]))}),[n]),(0,m.jsxs)("div",{className:"favorites-container",children:[(0,m.jsxs)("div",{className:"chat-title",children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(y.kRm,{className:"icon star"})}),(0,m.jsx)("h3",{children:"Favorites"})]}),(0,m.jsx)(o.Suspense,{fallback:(0,m.jsx)(V.Z,{}),children:(0,m.jsx)("div",{className:"favorites",children:null!==h&&void 0!==h&&h.length?(0,m.jsx)(m.Fragment,{children:Z(h).map((function(n){return(0,m.jsx)(M,{contactId:null===n||void 0===n?void 0:n.users.find((function(n){return n!==(null===e||void 0===e?void 0:e._id)})),messages:null===n||void 0===n?void 0:n.messages,isTyping:c[null===n||void 0===n?void 0:n._id]},null===n||void 0===n?void 0:n._id)}))}):null})})]})},K=t(34),A=function(){var n=(0,l.Z)().userInfo,e=(0,u.v9)(d.Rt),t=(0,u.v9)(d.Af),i=(0,o.useState)({}),s=(0,r.Z)(i,2),a=s[0],c=s[1],v=(0,f.Z)(),h=v.fetchUserChats,Z=v.sortChats,g=(0,u.v9)(d.Tc);return(0,C.Z)({events:{typing:function(n){var e=n.chatId;c((0,j.Z)((0,j.Z)({},a),{},(0,R.Z)({},e,!0)))},notTyping:function(n){var e=n.chatId;c((0,j.Z)((0,j.Z)({},a),{},(0,R.Z)({},e,!1)))}}}),(0,o.useEffect)((function(){t.length&&n&&h()}),[t,g]),(0,m.jsxs)("div",{className:"chat-contacts",children:[(0,m.jsxs)("div",{className:"chat-title",children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(y.RN2,{className:"icon small blue"})}),(0,m.jsx)("h3",{children:"Chats"})]}),(0,m.jsx)(o.Suspense,{fallback:(0,m.jsx)(V.Z,{}),children:null!==e&&void 0!==e&&e.length?Z(e).map((function(e){var t;return(0,m.jsx)(M,{contactId:null===(t=e.users)||void 0===t?void 0:t.find((function(e){return e!==(null===n||void 0===n?void 0:n._id)})),messages:e.messages,isTyping:a[e._id]},e._id)})):null})]})},D=t(4934),q=t(7689),B=t(3479),H=function(){var n=(0,f.Z)(),e=n.loadContacts,t=n.contacts,c=n.createNewChat,v=n.getContactInfo,j=n.currentChat,Z=(0,l.Z)().userInfo,g=(0,o.useState)(""),p=(0,r.Z)(g,2),_=p[0],C=p[1],k=(0,o.useState)(!1),E=(0,r.Z)(k,2),I=E[0],R=E[1],O=(0,o.useRef)(null),M=(0,o.useState)([]),V=(0,r.Z)(M,2),H=V[0],W=V[1],P=(0,u.I0)(),U=(0,D.Z)().currentProject,G=(0,q.s0)(),J=(0,S.Z)().isMobile,Q=(0,u.v9)(d.Ss),X=function(){var n=(0,a.Z)((0,s.Z)().mark((function n(e){return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,T.mb)(null===Z||void 0===Z?void 0:Z._id,e._id);case 2:if(!n.sent){n.next=10;break}v(null===Z||void 0===Z?void 0:Z._id,e._id),P((0,w.Ku)(e)),R(!1),C(""),n.next=15;break;case 10:return n.next=12,c(null===Z||void 0===Z?void 0:Z._id,e);case 12:P((0,w.Ku)(e)),R(!1),C("");case 15:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,o.useEffect)((function(){O.current&&_.length?R(!0):R(!1)}),[_]),(0,o.useEffect)((function(){_.length&&function(n){var e=n.toLowerCase(),i=t.filter((function(n){return n.first_name.toLowerCase().includes(e)||n.last_name.toLowerCase().includes(e)||(n.first_name.toLowerCase()||n.last_name.toLowerCase())===e||n.first_name.toLowerCase()+" "+n.last_name.toLowerCase()===e}));W(i)}(_)}),[_]),(0,o.useEffect)((function(){U&&P((0,F.Ce)(null))}),[]),(0,o.useEffect)((function(){t.length&&(t.some((function(n){return n._id===(null===Z||void 0===Z?void 0:Z._id)}))&&P((0,w.WT)((0,i.Z)(t.filter((function(n){return n._id!==(null===Z||void 0===Z?void 0:Z._id)}))))))}),[t]),(0,o.useEffect)((function(){Z&&(e(),j&&P((0,w.OB)(j.users[0],j.users[1])))}),[]),(0,o.useEffect)((function(){Z||G("/")}),[]),(0,m.jsxs)("div",{className:"main-chat-container",children:[(0,m.jsxs)("div",{className:Q&&J?"left open":"left",children:[J&&(0,m.jsx)(x.Z,{icon:(0,m.jsx)(y.fmn,{className:"icon"}),additionalClass:J?"mobile":"not-mobile",onClick:function(){P((0,w.EL)(!Q))}}),(0,m.jsxs)("div",{className:"main-chat-title",children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(B.tNe,{className:"icon"})}),(0,m.jsx)("h1",{children:"Chat"})]}),(0,m.jsx)(K.Z,{type:"text",refValue:O,placeholderText:"Search",fn:function(n){C(n.target.value)},value:_,icon:(0,m.jsx)(x.Z,{icon:(0,m.jsx)(y.dVI,{className:"icon"})})}),I?(0,m.jsx)("div",{className:"chat-search-results",children:H.length?H.map((function(n){return(0,m.jsxs)("div",{className:"profile",onClick:function(){return X(n)},children:[n.base64_img_data||n.img_url?(0,m.jsx)(N.Z,{src:n.base64_img_data||n.img_url}):(0,m.jsx)(b.Z,{}),(0,m.jsxs)("span",{children:[n.first_name," ",n.last_name]})]},n._id)})):null}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(z,{}),(0,m.jsx)(A,{})]})]}),(0,m.jsxs)("div",{className:"right",children:[(0,m.jsx)(L,{}),(0,m.jsx)(h,{})]})]})}},9143:function(n,e,t){t.d(e,{Z:function(){return a}});t(2791);var i=t.p+"static/media/blank-profile-picture.48af6c0bf2932eced28a.png",s=t(184),a=function(n){var e=n.size;return(0,s.jsx)("div",{className:"profile-img-container blank",children:(0,s.jsx)("img",{id:"blank-profile",src:i,alt:"blank profile",width:e||null,height:e||null})})}},2048:function(n,e,t){t(2791);var i=t(184);e.Z=function(n){var e=n.src,t=n.size;return(0,i.jsx)("div",{className:"profile-img-container",children:(0,i.jsx)("img",{src:e,alt:"profile",width:t||null,height:t||null})})}},4888:function(n,e,t){var i=t(2791),s=t(9434),a=t(7480),r=t(4083);e.Z=function(){var n=(0,s.v9)(r.eD),e=(0,s.I0)();return(0,i.useEffect)((function(){var n=function(){window.innerWidth<1441?e((0,a.Ep)(!0)):e((0,a.Ep)(!1))};return window.addEventListener("resize",n),window.addEventListener("load",n),function(){window.removeEventListener("resize",n),window.removeEventListener("load",n)}}),[]),{isMobile:n}}}}]);
//# sourceMappingURL=766.9f82f7b1.chunk.js.map