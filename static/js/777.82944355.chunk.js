"use strict";(self.webpackChunkproject_mania=self.webpackChunkproject_mania||[]).push([[777],{5777:function(n,e,t){t.r(e),t.d(e,{default:function(){return W}});var s=t(3433),i=t(4165),a=t(5861),r=t(9439),o=t(2791),c=t(4373),l=t(5305),u=t(9434),d=t(5224),v=t(6974),f=t(7145),m=t(184),h=function(){var n=(0,o.useState)(""),e=(0,r.Z)(n,2),t=e[0],s=e[1],i=(0,l.Z)().user,a=(0,o.useRef)(),h=(0,u.v9)(d.HL),x=(0,v.Z)(),Z=x.currentChat,j=x.handleSendMessage,g=(0,o.useState)(!1),p=(0,r.Z)(g,2),_=p[0],N=p[1],w=function(n){if(n.preventDefault(),t&&Z&&h){var e=new Date,a={text:t,from:i._id,sent_at:e.toISOString(),to:h._id};j(Z._id,a),s("")}};return(0,o.useEffect)((function(){if(!t)return N(!1),void(0,f.OA)(null===Z||void 0===Z?void 0:Z._id,null===h||void 0===h?void 0:h.socket_id,i._id);_||N(!0)}),[t]),(0,o.useEffect)((function(){_&&(0,f.FN)(null===Z||void 0===Z?void 0:Z._id,null===h||void 0===h?void 0:h.socket_id,i._id)}),[_]),(0,m.jsxs)("form",{id:"chat-input-container",onSubmit:w,children:[(0,m.jsx)("input",{type:"text",name:"chat_input",id:"chat_input",onChange:function(n){return s(n.target.value)},value:t,placeholder:"Type a message...",ref:a}),(0,m.jsx)("button",{type:"submit",className:"icon-span",onClick:w,children:(0,m.jsx)(c.ghy,{className:"icon large"})})]})},x=t(995),Z=t(1413),j=t(7470),g=t(2126),p=function(n){var e=n.msg,t=n.currentContact,s=e.sent_at,i=e.text,a=e.from;return(0,m.jsx)(m.Fragment,{children:(0,m.jsxs)("div",{className:a!==(null===t||void 0===t?void 0:t._id)?"message-container right-side":"message-container",children:[(0,m.jsx)("p",{className:"message",children:i}),(0,m.jsx)("span",{children:(0,g.I7)(s)})]})})},_=t(6747),N=t(2048),w=t(9143),C=t(5680),b=t(6594),E=t(3884),I=t(8820),k=t(9126),y=t(7640),S=t(7480),L=function(){var n=(0,v.Z)(),e=n.currentContact,t=n.messages,c=n.currentChat,f=n.setMessages,h=(0,o.useState)(""),L=(0,r.Z)(h,2),T=L[0],F=L[1],R=(0,u.I0)(),O=(0,o.useRef)(null),V=(0,o.useState)(!1),K=(0,r.Z)(V,2),M=K[0],z=K[1],A=(0,l.Z)().userInfo,D=(0,u.v9)(d.Tc);(0,b.Z)({events:{typing:function(n){n.userId===e._id&&z(!0)},notTyping:function(n){n.userId===e._id&&z(!1)}}});var q=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e){return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!D.some((function(n){return n===e}))){n.next=6;break}return n.next=3,(0,y.Nq)((0,Z.Z)((0,Z.Z)({},A),{},{favorites:(0,s.Z)(A.favorites.filter((function(n){return n!==e})))}));case 3:R((0,C.Lo)((0,s.Z)(D.filter((function(n){return n!==e}))))),n.next=9;break;case 6:return n.next=8,(0,y.Nq)((0,Z.Z)((0,Z.Z)({},A),{},{favorites:[].concat((0,s.Z)(A.favorites),[e])}));case 8:R((0,C.Lo)([].concat((0,s.Z)(D),[e])));case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,o.useEffect)((function(){if(!e)return F("");F("".concat(e.first_name," ").concat(e.last_name))}),[e]),(0,o.useEffect)((function(){c&&(R(f((0,s.Z)(null===c||void 0===c?void 0:c.messages))),c&&M&&z(!1))}),[c]),(0,o.useEffect)((function(){O.current.scrollIntoView({behavior:"smooth"})}),[t]),(0,o.useEffect)((function(){var n,e;null!==c&&void 0!==c&&null!==(n=c.messages)&&void 0!==n&&n.some((function(n){return!1===n.seen}))&&R((0,C.OK)((0,Z.Z)((0,Z.Z)({},c),{},{messages:(0,s.Z)(null===c||void 0===c||null===(e=c.messages)||void 0===e?void 0:e.map((function(n){return!1===n.seen?(0,Z.Z)((0,Z.Z)({},n),{},{seen:!0}):n})))})))}),[]),(0,m.jsxs)("div",{className:"conversation-container",children:[T&&(0,m.jsxs)("div",{className:"profile",children:[null!==e&&void 0!==e&&e.base64_img_data||null!==e&&void 0!==e&&e.img_url?(0,m.jsx)(N.Z,{src:(null===e||void 0===e?void 0:e.base64_img_data)||(null===e||void 0===e?void 0:e.img_url)}):(0,m.jsx)(w.Z,{}),(0,m.jsxs)("div",{className:"contact-name",children:[(0,m.jsx)("h3",{children:T}),!0===(null===e||void 0===e?void 0:e.online)?(0,m.jsx)("p",{className:"green",children:"online"}):(0,m.jsxs)("p",{children:["last seen ",(0,g.O7)(null===e||void 0===e?void 0:e.last_seen)]})]}),(0,m.jsx)(E.Z,{}),(0,m.jsx)("button",{className:"btn",title:"Add to favorites",onClick:function(){return q(null===e||void 0===e?void 0:e._id)},children:(0,m.jsx)(x.Z,{icon:(0,m.jsx)(k.kRm,{className:D.includes(null===e||void 0===e?void 0:e._id)?"icon star":"icon"})})}),(0,m.jsxs)("button",{className:"btn white",title:"View profile",onClick:function(){return n=e,R((0,S.zJ)(n)),void R((0,S.rC)(!0));var n},children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(I.nf1,{className:"icon xl"})}),(0,m.jsx)("span",{className:"text",children:"View profile"})]})]}),(0,m.jsx)(j.Z,{}),(0,m.jsxs)("div",{className:"conversation",children:[null!==t&&void 0!==t&&t.length?null===t||void 0===t?void 0:t.map((function(n){return(0,m.jsx)(p,{msg:n,currentContact:e},(0,_.H)())})):null,(0,m.jsx)("div",{children:M?(0,m.jsxs)("p",{className:"typing",children:[null===e||void 0===e?void 0:e.first_name," is typing..."]}):null}),(0,m.jsx)("div",{className:"messages-bottom",ref:O})]})]})},T=t(6871),F=t(2696),R=t(4942),O=t(6856),V=function(n){var e=n.contactId,t=n.messages,s=n.isTyping,c=(0,v.Z)().getContactInfo,d=(0,l.Z)().userInfo,f=(0,u.I0)(),h=(0,o.useState)(null),Z=(0,r.Z)(h,2),j=Z[0],p=Z[1],_=(0,o.useState)(0),b=(0,r.Z)(_,2),I=(b[0],b[1]),k=(0,o.useState)(null),y=(0,r.Z)(k,2),S=y[0],L=y[1],T=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e,t){var s;return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,c(t);case 2:s=n.sent,f((0,C.Ku)(s)),f((0,C.OB)(e,t));case 5:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),F=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e){return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:T(null===d||void 0===d?void 0:d._id,e),f((0,C.EL)(!1));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();(0,o.useEffect)((function(){null!==t&&void 0!==t&&t.length&&(p(t[t.length-1]),I(t.filter((function(n){return!1===n.seen&&n.from!==(null===d||void 0===d?void 0:d._id)})).length))}),[t]);var R=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e){var t;return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,c(e);case 2:t=n.sent,L(t);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,o.useEffect)((function(){R(e)}),[]),(0,m.jsxs)("div",{className:"contact",onClick:function(){return F(e)},children:[(0,m.jsx)("div",{className:"contact-image",children:null!==S&&void 0!==S&&S.base64_img_data||null!==S&&void 0!==S&&S.img_url?(0,m.jsx)(N.Z,{src:(null===S||void 0===S?void 0:S.base64_img_data)||(null===S||void 0===S?void 0:S.img_url)}):(0,m.jsx)(w.Z,{})}),(0,m.jsxs)("div",{className:"contact-content",children:[(0,m.jsxs)("h3",{className:"contact-name",children:[null===S||void 0===S?void 0:S.first_name," ",null===S||void 0===S?void 0:S.last_name]}),(0,m.jsx)("span",{className:"last-time-message-sent",children:null!==j&&void 0!==j&&j.sent_at?(0,g.I7)(null===j||void 0===j?void 0:j.sent_at):null}),(0,m.jsx)("p",{className:"last-message",children:s?(0,m.jsx)("span",{className:"typing green",children:"typing..."}):(0,m.jsx)(m.Fragment,{children:(null===j||void 0===j?void 0:j.from)===(null===d||void 0===d?void 0:d._id)?(0,m.jsx)(m.Fragment,{children:!0===(null===j||void 0===j?void 0:j.seen)?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(O.smy,{className:"icon green"})}),null===j||void 0===j?void 0:j.text]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(O.smy,{className:"icon"})}),null===j||void 0===j?void 0:j.text]})}):null===j||void 0===j?void 0:j.text})}),(0,m.jsx)(E.Z,{})]})]})},K=t(1823),M=function(){var n=(0,u.v9)(d.Tc),e=(0,l.Z)().userInfo,t=(0,u.I0)(),i=(0,o.useState)({}),a=(0,r.Z)(i,2),c=a[0],f=a[1],h=(0,u.v9)(d.lp),j=(0,v.Z)().sortChats;return(0,b.Z)({events:{typing:function(n){var e=n.chatId;f((0,Z.Z)((0,Z.Z)({},c),{},(0,R.Z)({},e,!0)))},notTyping:function(n){var e=n.chatId;f((0,Z.Z)((0,Z.Z)({},c),{},(0,R.Z)({},e,!1)))}}}),(0,o.useEffect)((function(){e&&t((0,C.Lo)((0,s.Z)(null===e||void 0===e?void 0:e.favorites)))}),[e]),(0,o.useEffect)((function(){n.length||!h.length||t((0,C.bu)([]))}),[n]),(0,m.jsxs)("div",{className:"favorites-container",children:[(0,m.jsxs)("div",{className:"chat-title",children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(k.kRm,{className:"icon star"})}),(0,m.jsx)("h3",{children:"Favorites"})]}),(0,m.jsx)(o.Suspense,{fallback:(0,m.jsx)(K.Z,{}),children:(0,m.jsx)("div",{className:"favorites",children:null!==h&&void 0!==h&&h.length?(0,m.jsx)(m.Fragment,{children:j(h).map((function(n){return(0,m.jsx)(V,{contactId:null===n||void 0===n?void 0:n.users.find((function(n){return n!==(null===e||void 0===e?void 0:e._id)})),messages:null===n||void 0===n?void 0:n.messages,isTyping:c[null===n||void 0===n?void 0:n._id]},null===n||void 0===n?void 0:n._id)}))}):null})})]})},z=t(34),A=function(){var n=(0,l.Z)().userInfo,e=(0,u.v9)(d.Rt),t=(0,u.v9)(d.Af),s=(0,o.useState)({}),i=(0,r.Z)(s,2),a=i[0],c=i[1],f=(0,v.Z)(),h=f.fetchUserChats,j=f.sortChats,g=(0,u.v9)(d.Tc);return(0,b.Z)({events:{typing:function(n){var e=n.chatId;c((0,Z.Z)((0,Z.Z)({},a),{},(0,R.Z)({},e,!0)))},notTyping:function(n){var e=n.chatId;c((0,Z.Z)((0,Z.Z)({},a),{},(0,R.Z)({},e,!1)))}}}),(0,o.useEffect)((function(){t.length&&n&&h()}),[t,g]),(0,m.jsxs)("div",{className:"chat-contacts",children:[(0,m.jsxs)("div",{className:"chat-title",children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(k.RN2,{className:"icon small blue"})}),(0,m.jsx)("h3",{children:"Chats"})]}),(0,m.jsx)(o.Suspense,{fallback:(0,m.jsx)(K.Z,{}),children:null!==e&&void 0!==e&&e.length?j(e).map((function(e){var t;return(0,m.jsx)(V,{contactId:null===(t=e.users)||void 0===t?void 0:t.find((function(e){return e!==(null===n||void 0===n?void 0:n._id)})),messages:e.messages,isTyping:a[e._id]},e._id)})):null})]})},D=t(6419),q=t(7689),B=t(4888),H=t(3479),W=function(){var n=(0,v.Z)(),e=n.loadContacts,t=n.contacts,c=n.createNewChat,f=n.getContactInfo,Z=n.currentChat,j=(0,l.Z)().userInfo,g=(0,o.useState)(""),p=(0,r.Z)(g,2),_=p[0],b=p[1],E=(0,o.useState)(!1),I=(0,r.Z)(E,2),y=I[0],S=I[1],R=(0,o.useRef)(null),O=(0,o.useState)([]),V=(0,r.Z)(O,2),K=V[0],W=V[1],J=(0,u.I0)(),P=(0,D.Z)().currentProject,U=(0,q.s0)(),G=(0,B.Z)().isMobile,Q=(0,u.v9)(d.Ss),X=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e){return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,T.mb)(null===j||void 0===j?void 0:j._id,e._id);case 2:if(!n.sent){n.next=10;break}f(null===j||void 0===j?void 0:j._id,e._id),J((0,C.Ku)(e)),S(!1),b(""),n.next=15;break;case 10:return n.next=12,c(null===j||void 0===j?void 0:j._id,e);case 12:J((0,C.Ku)(e)),S(!1),b("");case 15:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,o.useEffect)((function(){R.current&&_.length?S(!0):S(!1)}),[_]),(0,o.useEffect)((function(){_.length&&function(n){var e=n.toLowerCase(),s=t.filter((function(n){return n.first_name.toLowerCase().includes(e)||n.last_name.toLowerCase().includes(e)||(n.first_name.toLowerCase()||n.last_name.toLowerCase())===e||n.first_name.toLowerCase()+" "+n.last_name.toLowerCase()===e}));W(s)}(_)}),[_]),(0,o.useEffect)((function(){P&&J((0,F.Ce)(null))}),[]),(0,o.useEffect)((function(){t.length&&(t.some((function(n){return n._id===(null===j||void 0===j?void 0:j._id)}))&&J((0,C.WT)((0,s.Z)(t.filter((function(n){return n._id!==(null===j||void 0===j?void 0:j._id)}))))))}),[t]),(0,o.useEffect)((function(){j&&(e(),J(Z?(0,C.OB)(Z.users[0],Z.users[1]):(0,C.EL)(!0)))}),[]),(0,o.useEffect)((function(){j||U("/")}),[]),(0,m.jsxs)("div",{className:"main-chat-container",children:[(0,m.jsxs)("div",{className:Q?"left open":"left",children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(k.fmn,{className:"icon"}),additionalClass:G?"mobile":"not-mobile",onClick:function(){J((0,C.EL)(!Q))}}),(0,m.jsxs)("div",{className:"main-chat-title",children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(H.tNe,{className:"icon"})}),(0,m.jsx)("h1",{children:"Chat"})]}),(0,m.jsx)(z.Z,{type:"text",refValue:R,placeholderText:"Search",fn:function(n){b(n.target.value)},value:_,icon:(0,m.jsx)(x.Z,{icon:(0,m.jsx)(k.dVI,{className:"icon"})})}),y?(0,m.jsx)("div",{className:"chat-search-results",children:K.length?K.map((function(n){return(0,m.jsxs)("div",{className:"profile",onClick:function(){return X(n)},children:[n.base64_img_data||n.img_url?(0,m.jsx)(N.Z,{src:n.base64_img_data||n.img_url}):(0,m.jsx)(w.Z,{}),(0,m.jsxs)("span",{children:[n.first_name," ",n.last_name]})]},n._id)})):null}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(M,{}),(0,m.jsx)(A,{})]})]}),(0,m.jsxs)("div",{className:"right",children:[(0,m.jsx)(L,{}),(0,m.jsx)(h,{})]})]})}},4888:function(n,e,t){var s=t(2791),i=t(9434),a=t(7480),r=t(4083);e.Z=function(){var n=(0,i.v9)(r.eD),e=(0,i.I0)(),t=function(){window.innerWidth<=1280?e((0,a.Ep)(!0)):e((0,a.Ep)(!1))};return(0,s.useEffect)((function(){return window.addEventListener("load",t),window.addEventListener("resize",t),function(){window.removeEventListener("load",t),window.removeEventListener("resize",t)}}),[]),{isMobile:n}}}}]);
//# sourceMappingURL=777.82944355.chunk.js.map