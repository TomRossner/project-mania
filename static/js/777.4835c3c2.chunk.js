"use strict";(self.webpackChunkproject_mania=self.webpackChunkproject_mania||[]).push([[777],{5777:function(n,e,t){t.r(e),t.d(e,{default:function(){return W}});var s=t(3433),i=t(4165),a=t(5861),o=t(9439),r=t(2791),c=t(4373),l=t(5305),u=t(9434),d=t(5224),f=t(6974),v=t(7145),m=t(184),h=function(){var n=(0,r.useState)(""),e=(0,o.Z)(n,2),t=e[0],s=e[1],i=(0,l.Z)().user,a=(0,r.useRef)(),h=(0,u.v9)(d.HL),x=(0,f.Z)(),Z=x.currentChat,j=x.handleSendMessage,g=(0,r.useState)(!1),p=(0,o.Z)(g,2),_=p[0],N=p[1],C=function(n){if(n.preventDefault(),t&&Z&&h){var e=new Date,a={text:t,from:i._id,sent_at:e.toISOString(),to:h._id};j(Z._id,a),s("")}};return(0,r.useEffect)((function(){if(!t.length)return N(!1),void(0,v.OA)(null===Z||void 0===Z?void 0:Z._id,null===h||void 0===h?void 0:h.socket_id);_||N(!0)}),[t]),(0,r.useEffect)((function(){_&&(0,v.FN)(null===Z||void 0===Z?void 0:Z._id,null===h||void 0===h?void 0:h.socket_id)}),[_]),(0,m.jsxs)("form",{id:"chat-input-container",onSubmit:C,children:[(0,m.jsx)("input",{type:"text",name:"chat_input",id:"chat_input",onChange:function(n){return s(n.target.value)},value:t,placeholder:"Type a message...",ref:a}),(0,m.jsx)("button",{type:"submit",className:"icon-span",onClick:C,children:(0,m.jsx)(c.ghy,{className:"icon large"})})]})},x=t(995),Z=t(1413),j=t(7470),g=t(2126),p=function(n){var e=n.msg,t=n.currentContact,s=e.sent_at,i=e.text,a=e.from;return(0,m.jsx)(m.Fragment,{children:(0,m.jsxs)("div",{className:a!==(null===t||void 0===t?void 0:t._id)?"message-container right-side":"message-container",children:[(0,m.jsx)("p",{className:"message",children:i}),(0,m.jsx)("span",{children:(0,g.I7)(s)})]})})},_=t(6747),N=t(2048),C=t(9143),b=t(5680),w=t(6594),y=t(3884),E=t(8820),I=t(9126),k=t(7640),S=t(4888),L=function(){var n=(0,f.Z)(),e=n.currentContact,t=n.messages,c=n.currentChat,v=n.setMessages,h=(0,r.useState)(""),L=(0,o.Z)(h,2),T=L[0],F=L[1],R=(0,u.I0)(),O=(0,r.useRef)(null),M=(0,r.useState)(!1),V=(0,o.Z)(M,2),K=V[0],A=V[1],D=(0,l.Z)().userInfo,q=(0,u.v9)(d.Tc);(0,S.Z)().isMobile;(0,w.Z)({events:{typing:function(){return A(!0)},notTyping:function(){return A(!1)}}}),(0,r.useEffect)((function(){if(!e)return F("");F("".concat(e.first_name," ").concat(e.last_name))}),[e]),(0,r.useEffect)((function(){c&&R(v((0,s.Z)(null===c||void 0===c?void 0:c.messages)))}),[c]);(0,r.useEffect)((function(){O.current.scrollIntoView({behavior:"smooth"})}),[t]);var B=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e){return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!q.some((function(n){return n===e}))){n.next=6;break}return n.next=3,(0,k.Nq)((0,Z.Z)((0,Z.Z)({},D),{},{favorites:(0,s.Z)(D.favorites.filter((function(n){return n!==e})))}));case 3:R((0,b.Lo)((0,s.Z)(q.filter((function(n){return n!==e}))))),n.next=9;break;case 6:return n.next=8,(0,k.Nq)((0,Z.Z)((0,Z.Z)({},D),{},{favorites:[].concat((0,s.Z)(D.favorites),[e])}));case 8:R((0,b.Lo)([].concat((0,s.Z)(q),[e])));case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,r.useEffect)((function(){var n,e;null!==c&&void 0!==c&&null!==(n=c.messages)&&void 0!==n&&n.some((function(n){return!1===n.seen}))&&R((0,b.OK)((0,Z.Z)((0,Z.Z)({},c),{},{messages:(0,s.Z)(null===c||void 0===c||null===(e=c.messages)||void 0===e?void 0:e.map((function(n){return!1===n.seen?(0,Z.Z)((0,Z.Z)({},n),{},{seen:!0}):n})))})))}),[]),(0,m.jsxs)("div",{className:"conversation-container",children:[T&&(0,m.jsxs)("div",{className:"profile",children:[null!==e&&void 0!==e&&e.base64_img_data||null!==e&&void 0!==e&&e.img_url?(0,m.jsx)(N.Z,{src:(null===e||void 0===e?void 0:e.base64_img_data)||(null===e||void 0===e?void 0:e.img_url)}):(0,m.jsx)(C.Z,{}),(0,m.jsxs)("div",{className:"contact-name",children:[(0,m.jsx)("h3",{children:T}),!0===(null===e||void 0===e?void 0:e.online)?(0,m.jsx)("p",{className:"green",children:"online"}):(0,m.jsxs)("p",{children:["last seen ",(0,g.O7)(null===e||void 0===e?void 0:e.last_seen)]})]}),(0,m.jsx)(y.Z,{}),(0,m.jsx)("button",{className:"btn",title:"Add to favorites",onClick:function(){return B(null===e||void 0===e?void 0:e._id)},children:(0,m.jsx)(x.Z,{icon:(0,m.jsx)(I.kRm,{className:q.includes(null===e||void 0===e?void 0:e._id)?"icon star":"icon"})})}),(0,m.jsxs)("button",{className:"btn white",title:"View profile",children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(E.nf1,{className:"icon xl"})}),(0,m.jsx)("span",{className:"text",children:"View profile"})]})]}),(0,m.jsx)(j.Z,{}),(0,m.jsxs)("div",{className:"conversation",children:[null!==t&&void 0!==t&&t.length?null===t||void 0===t?void 0:t.map((function(n){return(0,m.jsx)(p,{msg:n,currentContact:e},(0,_.H)())})):null,(0,m.jsx)("div",{children:K?(0,m.jsxs)("p",{className:"typing",children:[null===e||void 0===e?void 0:e.first_name," is typing..."]}):null}),(0,m.jsx)("div",{className:"messages-bottom",ref:O})]})]})},T=t(6871),F=t(2696),R=t(4942),O=t(6856),M=function(n){var e=n.contactId,t=n.messages,s=n.isTyping,c=(0,f.Z)(),d=c.getContactInfo,v=(c.currentChat,(0,l.Z)().userInfo),h=(0,u.I0)(),Z=(0,r.useState)(null),j=(0,o.Z)(Z,2),p=j[0],_=j[1],w=(0,r.useState)(0),E=(0,o.Z)(w,2),I=(E[0],E[1]),k=(0,r.useState)(null),S=(0,o.Z)(k,2),L=S[0],T=S[1],F=function(n,e){h((0,b.OB)(n,e))},R=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e){return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:F(null===v||void 0===v?void 0:v._id,e),h((0,b.Ku)(L)),h((0,b.EL)(!1));case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();(0,r.useEffect)((function(){null!==t&&void 0!==t&&t.length&&(_(t[t.length-1]),I(t.filter((function(n){return!1===n.seen&&n.from!==(null===v||void 0===v?void 0:v._id)})).length))}),[t]);var M=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e){var t;return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,d(e);case 2:t=n.sent,T(t);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,r.useEffect)((function(){M(e)}),[]),(0,m.jsxs)("div",{className:"contact",onClick:function(){return R(e)},children:[(0,m.jsx)("div",{className:"contact-image",children:null!==L&&void 0!==L&&L.base64_img_data||null!==L&&void 0!==L&&L.img_url?(0,m.jsx)(N.Z,{src:(null===L||void 0===L?void 0:L.base64_img_data)||(null===L||void 0===L?void 0:L.img_url)}):(0,m.jsx)(C.Z,{})}),(0,m.jsxs)("div",{className:"contact-content",children:[(0,m.jsxs)("h3",{className:"contact-name",children:[null===L||void 0===L?void 0:L.first_name," ",null===L||void 0===L?void 0:L.last_name]}),(0,m.jsx)("span",{className:"last-time-message-sent",children:null!==p&&void 0!==p&&p.sent_at?(0,g.I7)(null===p||void 0===p?void 0:p.sent_at):null}),(0,m.jsx)("p",{className:"last-message",children:s?(0,m.jsx)("span",{className:"typing green",children:"typing..."}):(0,m.jsx)(m.Fragment,{children:(null===p||void 0===p?void 0:p.from)===(null===v||void 0===v?void 0:v._id)?(0,m.jsx)(m.Fragment,{children:!0===(null===p||void 0===p?void 0:p.seen)?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(O.smy,{className:"icon green"})}),null===p||void 0===p?void 0:p.text]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(O.smy,{className:"icon"})}),null===p||void 0===p?void 0:p.text]})}):null===p||void 0===p?void 0:p.text})}),(0,m.jsx)(y.Z,{})]})]})},V=t(1823),K=function(){var n=(0,u.v9)(d.Tc),e=(0,l.Z)().userInfo,t=(0,u.I0)(),i=(0,r.useState)({}),a=(0,o.Z)(i,2),c=a[0],v=a[1],h=(0,u.v9)(d.lp),j=(0,f.Z)().sortChats;return(0,w.Z)({events:{typing:function(n){var e=n.chatId;v((0,Z.Z)((0,Z.Z)({},c),{},(0,R.Z)({},e,!0)))},notTyping:function(n){var e=n.chatId;v((0,Z.Z)((0,Z.Z)({},c),{},(0,R.Z)({},e,!1)))}}}),(0,r.useEffect)((function(){e&&t((0,b.Lo)((0,s.Z)(null===e||void 0===e?void 0:e.favorites)))}),[e]),(0,r.useEffect)((function(){n.length||!h.length||t((0,b.bu)([]))}),[n]),(0,m.jsxs)("div",{className:"favorites-container",children:[(0,m.jsxs)("div",{className:"chat-title",children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(I.kRm,{className:"icon star"})}),(0,m.jsx)("h3",{children:"Favorites"})]}),(0,m.jsx)(r.Suspense,{fallback:(0,m.jsx)(V.Z,{}),children:(0,m.jsx)("div",{className:"favorites",children:null!==h&&void 0!==h&&h.length?(0,m.jsx)(m.Fragment,{children:j(h).map((function(n){return(0,m.jsx)(M,{contactId:null===n||void 0===n?void 0:n.users.find((function(n){return n!==(null===e||void 0===e?void 0:e._id)})),messages:null===n||void 0===n?void 0:n.messages,isTyping:c[null===n||void 0===n?void 0:n._id]},null===n||void 0===n?void 0:n._id)}))}):null})})]})},A=t(34),D=function(){var n=(0,l.Z)().userInfo,e=(0,u.v9)(d.Rt),t=(0,u.v9)(d.Af),s=(0,r.useState)({}),i=(0,o.Z)(s,2),a=i[0],c=i[1],v=(0,f.Z)(),h=v.fetchUserChats,j=v.sortChats,g=(0,u.v9)(d.Tc);return(0,w.Z)({events:{typing:function(n){var e=n.chatId;c((0,Z.Z)((0,Z.Z)({},a),{},(0,R.Z)({},e,!0)))},notTyping:function(n){var e=n.chatId;c((0,Z.Z)((0,Z.Z)({},a),{},(0,R.Z)({},e,!1)))}}}),(0,r.useEffect)((function(){t.length&&n&&h()}),[t,g]),(0,m.jsxs)("div",{className:"chat-contacts",children:[(0,m.jsxs)("div",{className:"chat-title",children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(I.RN2,{className:"icon small blue"})}),(0,m.jsx)("h3",{children:"Chats"})]}),(0,m.jsx)(r.Suspense,{fallback:(0,m.jsx)(V.Z,{}),children:null!==e&&void 0!==e&&e.length?j(e).map((function(e){var t;return(0,m.jsx)(M,{contactId:null===(t=e.users)||void 0===t?void 0:t.find((function(e){return e!==(null===n||void 0===n?void 0:n._id)})),messages:e.messages,isTyping:a[e._id]},e._id)})):null})]})},q=t(4934),B=t(7689),H=t(3479),W=function(){var n=(0,f.Z)(),e=n.loadContacts,t=n.contacts,c=n.createNewChat,v=n.getContactInfo,Z=n.currentChat,j=(0,l.Z)().userInfo,g=(0,r.useState)(""),p=(0,o.Z)(g,2),_=p[0],w=p[1],y=(0,r.useState)(!1),E=(0,o.Z)(y,2),k=E[0],R=E[1],O=(0,r.useRef)(null),M=(0,r.useState)([]),V=(0,o.Z)(M,2),W=V[0],P=V[1],U=(0,u.I0)(),z=(0,q.Z)().currentProject,G=(0,B.s0)(),J=(0,S.Z)().isMobile,Q=(0,u.v9)(d.Ss),X=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e){return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,T.mb)(null===j||void 0===j?void 0:j._id,e._id);case 2:if(!n.sent){n.next=10;break}v(null===j||void 0===j?void 0:j._id,e._id),U((0,b.Ku)(e)),R(!1),w(""),n.next=15;break;case 10:return n.next=12,c(null===j||void 0===j?void 0:j._id,e);case 12:U((0,b.Ku)(e)),R(!1),w("");case 15:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,r.useEffect)((function(){O.current&&_.length?R(!0):R(!1)}),[_]),(0,r.useEffect)((function(){_.length&&function(n){var e=n.toLowerCase(),s=t.filter((function(n){return n.first_name.toLowerCase().includes(e)||n.last_name.toLowerCase().includes(e)||(n.first_name.toLowerCase()||n.last_name.toLowerCase())===e||n.first_name.toLowerCase()+" "+n.last_name.toLowerCase()===e}));P(s)}(_)}),[_]),(0,r.useEffect)((function(){z&&U((0,F.Ce)(null))}),[]),(0,r.useEffect)((function(){t.length&&(t.some((function(n){return n._id===(null===j||void 0===j?void 0:j._id)}))&&U((0,b.WT)((0,s.Z)(t.filter((function(n){return n._id!==(null===j||void 0===j?void 0:j._id)}))))))}),[t]),(0,r.useEffect)((function(){j&&(e(),Z&&U((0,b.OB)(Z.users[0],Z.users[1])))}),[]),(0,r.useEffect)((function(){j||G("/")}),[]),(0,m.jsxs)("div",{className:"main-chat-container",children:[(0,m.jsxs)("div",{className:Q?"left open":"left",children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(I.fmn,{className:"icon"}),additionalClass:J?"mobile":"not-mobile",onClick:function(){U((0,b.EL)(!Q))}}),(0,m.jsxs)("div",{className:"main-chat-title",children:[(0,m.jsx)(x.Z,{icon:(0,m.jsx)(H.tNe,{className:"icon"})}),(0,m.jsx)("h1",{children:"Chat"})]}),(0,m.jsx)(A.Z,{type:"text",refValue:O,placeholderText:"Search",fn:function(n){w(n.target.value)},value:_,icon:(0,m.jsx)(x.Z,{icon:(0,m.jsx)(I.dVI,{className:"icon"})})}),k?(0,m.jsx)("div",{className:"chat-search-results",children:W.length?W.map((function(n){return(0,m.jsxs)("div",{className:"profile",onClick:function(){return X(n)},children:[n.base64_img_data||n.img_url?(0,m.jsx)(N.Z,{src:n.base64_img_data||n.img_url}):(0,m.jsx)(C.Z,{}),(0,m.jsxs)("span",{children:[n.first_name," ",n.last_name]})]},n._id)})):null}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(K,{}),(0,m.jsx)(D,{})]})]}),(0,m.jsxs)("div",{className:"right",children:[(0,m.jsx)(L,{}),(0,m.jsx)(h,{})]})]})}},4888:function(n,e,t){var s=t(2791),i=t(9434),a=t(7480),o=t(4083);e.Z=function(){var n=(0,i.v9)(o.eD),e=(0,i.I0)(),t=function(){window.innerWidth<=1280?e((0,a.Ep)(!0)):e((0,a.Ep)(!1))};return(0,s.useEffect)((function(){return window.addEventListener("load",t),function(){window.removeEventListener("load",t)}}),[]),{isMobile:n}}}}]);
//# sourceMappingURL=777.4835c3c2.chunk.js.map